game.states.CRE_Brewery_SpeakingKobold = State{function()
    description = [[Speaking kobold behaviour]]
    modules = {"shared.dialog"}

    ------------------------------------------------
    -- Params
    ------------------------------------------------

    ------------------------------------------------
    -- Local State variables
    local repeatedAD = Dialog("CRE_Brewery_AD_DrunkCheering_d18751c4-7061-af23-681e-d4905dac459c")

    local secondNPC = Entity("S_CRE_Brewery_Kobold8_5995bb68-326f-4e89-8921-cbca363f926f")
    local playerInADZone = Flag("CRE_Brewery_Status_PlayersCanHearADs_4363567f-c513-4dcb-916d-7576249da6eb")
    ------------------------------------------------ 

    ------------------------------------------------
    -- Helper functions
    ------------------------------------------------
 
    ------------------------------------------------
    -- State (self) node functions
    ------------------------------------------------
    
    ------------------------------------------------
    -- Nodes

    -- Action
    -- Unless killed, the guards keep talking with a rate limited AD

    nodes.Action_ADLoop = Action{
        function()
            mod.dialog.StartCheckedAutomatedDialogRateLimited(
                    repeatedAD,
                    {
                        waitForCompletion = true,
                        minDelay = 6.0,
                    },
                    me,
                    secondNPC
                )            
        end,

        Valid = function()
            return GetFlag(playerInADZone)
        end
    }

    nodes.Action_Fallback = Action{
        function()
            Sleep(5.0)
        end,
        Valid = function()
            return not GetFlag(playerInADZone)
        end
    }    

    ------------------------------------------------
    
    ------------------------------------------------
    -- Events
    ------------------------------------------------

end
}