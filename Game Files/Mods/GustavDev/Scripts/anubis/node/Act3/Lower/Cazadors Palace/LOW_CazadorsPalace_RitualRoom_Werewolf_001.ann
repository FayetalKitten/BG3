game.states.LOW_CazadorsPalace_RitualRoom_Werewolf_001 = State {

    function()

        modules = { "shared.dialog", "shared.util" }

        local beforeRitualFlag = Flag("LOW_CazadorsPalace_RitualRoom_State_BeforeRitual_540f9932-f058-48a3-8fa2-21254b7f830e")
        local beforeRitualAD = Dialog("LOW_CazadorsPalace_RitualRoom_AD_RitualBarks_22c65e05-81d6-af95-fa08-e3c77d8f7c63")
        local partner = Entity("S_LOW_CazadorsPalace_RitualRoom_Werewolf_04_f8eb826d-9071-4fc4-aeee-9383fab42bac")
        local cheeringAnim = Animation("CUST_Cheering_01_bb17118b-9bdc-4003-b9ad-26eda135e1a0")
        local cazador = Entity("S_GLO_Cazador_2f1880e6-1297-4ca3-a79c-9fabc7f179d3")

        nodes.BeforeRitual = Selector {
            function(nodes)
                return FindWeightedRandomSelectable(nodes, {
                    [nodes.Cheering] = 1,
                    [nodes.Wait] = 1,
                    [nodes.Talk] = 3,
                })
            end,
            CanEnter = function()
                return GetFlag(beforeRitualFlag)
            end
        }

        nodes.BeforeRitual.Cheering = Action {
            function()
                SteerTo(cazador)
                PlayAnimation(cheeringAnim, true)
                mod.util.SleepRandom(6.0, 12.0)
            end,
            CanEnter = function()
                return mod.dialog.IsSpeakerAvailable(me)
            end
        }

        nodes.BeforeRitual.Wait = Action {
            function()
                SteerTo(cazador)
                mod.util.SleepRandom(3.0, 9.0)
            end
        }

        nodes.BeforeRitual.Talk = Action {
            function()
                mod.dialog.StartCheckedAutomatedDialogRateLimited(
                    beforeRitualAD,
                    {
                        waitForCompletion = false,
                        minDelay = 20.0,
                    },
                    me,
                    partner
                )
                mod.util.SleepRandom(3.0, 9.0)
            end
        }

        nodes.Wait = Action {
            function()
                SteerTo(cazador)
                mod.util.SleepRandom(3.0, 9.0)
            end
        }

    end
}