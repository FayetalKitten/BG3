game.states.LOW_CazadorsPalace_Servant_001 = State {

    function()

        modules = { "shared.util" }

        local patrolSpline = Spline("S_LOW_CazadorsPalace_PatrolSplineForServant_001_691b91cc-9f1d-49eb-86a6-f56c14627a65")
        local patrolSplineIndex = 0
        local pausedForAD = false

        local AD = Dialog("LOW_CazadorsPalace_Servant_001_AD_179cdba3-00f2-b5ed-4822-8671a383b69f")

        nodes.Talk = Action{

            OnEnter = function()
                ShortPatrolInterrupt()
            end,

            function()

                LookFrom(patrolSpline)

                StartAutomatedDialog(AD, true, me)
                mod.util.SleepRandom(3, 9)

                pausedForAD = false

            end,

            OnInterrupt = function()
                pausedForAD = false
            end,

            Valid = function()
                return pausedForAD
            end
        }

        nodes.Patrol = Action{
            function()
                DoPatrol(patrolSpline, false, MovementSpeed.Walk, patrolSplineIndex)
            end,

            Valid = function()
                return patrolSpline ~= nil
            end
        }

        events.SplineControlPointReached = function(e)

            patrolSplineIndex = e.NewIndex

            pausedForAD = true

        end

    end

}